<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>v6</title>
    <script defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 768px;
            margin: 0 auto;
            height: 100%;
        }

        #map {
            height: 100%;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>–ù–∞—à–∏ –æ—Ñ–∏—Å—ã –Ω–∞ –∫–∞—Ä—Ç–µ</h1>
        <select id="city">
            <option value="1">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
            <option value="2">–ú–æ—Å–∫–≤–∞</option>
            <option value="3">–°–∞–º–∞—Ä–∞</option>
        </select>
        <div id="map"></div>
    </div>

    <script>

        // –ü–ª–∞–Ω:
        // 1. –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä contentTemplate(point) {...}.
        // –§—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±—ä–µ–∫—Ç –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏, –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Ä–∞–∑–º–µ—Ç–∫–∏.
        // –í–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—É–Ω–∫—Ç—ã –Ω–µ –∏–º–µ—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è).
        // 2. –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Å—Ç—Ä–∫—É—Ç—É—Ä–∏–∑–∞—Ü–∏—é –∏ –∫–æ—Ä–æ—Ä—Ç–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Ç–∞–º –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.

        const cities = [
            {
                id: 1,
                name: "–ú–æ—Å–∫–≤–∞",
                lat: 55.751667,
                lng: 37.617778,
                zoom: 11,
            },
            {
                id: 2,
                name: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                lat: 59.937500,
                lng: 30.308611,
                zoom: 12,
            }
        ];

        const points = [
            {
                id: 1,
                address: "–ø—Ä. –ö–∏—Ä–æ–≤–∞, –¥. 14, –∫–æ—Ä–ø. 3.",
                imgUrl: "https://loremflickr.com/200/300?random=1",
                lat: 55.711667,
                lng: 37.647778,
            },
            {
                id: 2,
                address: "–ø–ª. –°—Ç–∞–ª–∏–Ω–∞, –¥. 30, –∫–æ—Ä–ø. 16.",
                imgUrl: null,
                lat: 55.691667,
                lng: 37.677778,
            },
            {
                id: 3,
                address: "–ø–µ—Ä. –î–æ—Ä–æ—Ñ–µ–µ–≤a, –¥. 60.",
                imgUrl: "https://loremflickr.com/200/300?random=3",
                lat: 59.962462,
                lng: 30.353675,
            },
            {
                id: 4,
                address: "—É–ª. –í–ª–∞–¥–∏–º–∏—Ä–æ–≤a, –¥. 61.",
                imgUrl: "https://loremflickr.com/200/300?random=4",
                lat: 59.883326,
                lng: 30.249048,
            },
            {
                id: 5,
                address: "–ø–ª. –ù–∞—É–º–æ–≤a, –¥. 79, –∫–æ—Ä–ø. 90.",
                imgUrl: null,
                lat: 59.945202,
                lng: 30.344276,
            },

        ];

        const infoWindows = [];
        const compmanyName = '–ö–æ–∫—Å–±–µ—Ä—Ä–∏';
        const currentCityId = 1;
        const { lat, lng } = cities.find(city => city.id === currentCityId); // –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞

        // —Ñ—É–Ω–∫—Ü–∏—è-—à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä
        function contentTemplate(point) {

            const img = point.imgUrl ? `<img src="${point.imgUrl}"/>` : '';

            const content = `<div>
                <h3>${compmanyName}</h3>
                <div>
                    ${img}
                    <address>${point.address}</address>
                </div>
            </div>`;

            return content;
        }

        let map;

        function initMap() {

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat, lng }, // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
                zoom: 11,
                disableDefaultUI: true
            });

            points.forEach((point) => {

                const { lat, lng, imgUrl, address } = point; // –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞

                const marker = new google.maps.Marker({ position: { lat, lng }, map }); // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞

                const content = contentTemplate(point); // –ø–æ–ª—É—á–∞–µ–º –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Ä–∞–∑–º–µ—Ç–∫–∏

                const infoWindow = new google.maps.InfoWindow({ content }); // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
                infoWindows.push(infoWindow);

                marker.addListener('click', () => {
                    infoWindows.forEach(infoWindow => infoWindow.close());
                    infoWindow.open(map, marker);
                });
            });

        }

        document.querySelector("#city").addEventListener("change", (event) => {

            const selectedCityId = event.target.value;
            const { lat, lng, zoom } = cities.find(city => city.id == selectedCityId);  // –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞

            map.setOptions({
                center: { lat, lng }, // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
                zoom // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
            });
        })


        // –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–ª–∏ –∫–æ–¥! üëç
        // –ü–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é: https://learn.javascript.ru/destructuring-assignment#destrukturizatsiya-obekta
        // –ü–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞: https://learn.javascript.ru/object#svoystvo-iz-peremennoy
        // TODO: –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
    </script>
</body>

</html>