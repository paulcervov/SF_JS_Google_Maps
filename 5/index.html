<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>v5</title>
    <script defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCL7_cBFaxTj5l1YcIEAOqVOhkrPtvAOV4&callback=initMap"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 768px;
            margin: 0 auto;
            height: 100%;
        }

        #map {
            height: 100%;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>–ù–∞—à–∏ –æ—Ñ–∏—Å—ã –Ω–∞ –∫–∞—Ä—Ç–µ</h1>
        <select id="city"></select>
        <div id="map"></div>
    </div>

    <script>

        // 1. –°–æ–∑–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ –≥–æ—Ä–æ–¥–æ–≤, –∫–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ - –æ–±—ä–µ–∫—Ç —Å –Ω—É–∂–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏: id, name –∏ –ø—Ä–æ—á
        // 2. –ü–æ–ª—É—á–∞–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞ —Ç–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –≥–æ—Ä–æ–¥–∞
        // 3. –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞–∑–º–µ—Ç–∫—É —Å–µ–ª–µ–∫—Ç –≥–æ—Ä–æ–¥–æ–≤, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ (–∏–∑ –º–∞—Å—Å–∏–≤–∞ –≥–æ—Ä–æ–¥–æ–≤)
        // 4. –ü–æ–≤–µ—Å–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ –∏–∑ —Å–ø–∏—Å–∫–∞, –≤ —Ç–µ–ª–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞, –æ—Ç—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –≥–æ—Ä–æ–¥–∞
        // 5. –û—Ç–∫–ª—é—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ

        // –ú–∞—Å—Å–∏–≤ –≥–æ—Ä–æ–¥–æ–≤
        const cities = [
        {
                id: 1,
                name: "–ú–æ—Å–∫–≤–∞",
                lat: 55.751667,
                lng: 37.617778,
                zoom: 11,
            },
            {
                id: 2,
                name: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                lat: 59.937500,
                lng: 30.308611,
                zoom: 12,
            }
        ];

        // –ú–∞—Å—Å–∏–≤ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏
        const points = [
        {
                id: 1,
                address: "–ø—Ä. –ö–∏—Ä–æ–≤–∞, –¥. 14, –∫–æ—Ä–ø. 3.",
                imgUrl: "https://loremflickr.com/200/300?random=1",
                lat: 55.711667,
                lng: 37.647778,
            },
            {
                id: 2,
                address: "–ø–ª. –°—Ç–∞–ª–∏–Ω–∞, –¥. 30, –∫–æ—Ä–ø. 16.",
                imgUrl: "https://loremflickr.com/200/300?random=2",
                lat: 55.691667,
                lng: 37.677778,
            },
        {
                id: 3,
                address: "–ø–µ—Ä. –î–æ—Ä–æ—Ñ–µ–µ–≤a, –¥. 60.",
                imgUrl: "https://loremflickr.com/200/300?random=3",
                lat: 59.962462,
                lng: 30.353675,
            },
            {
                id: 4,
                address: "—É–ª. –í–ª–∞–¥–∏–º–∏—Ä–æ–≤a, –¥. 61.",
                imgUrl: "https://loremflickr.com/200/300?random=4",
                lat: 59.883326,
                lng: 30.249048,
            },
            {
                id: 5,
                address: "–ø–ª. –ù–∞—É–º–æ–≤a, –¥. 79, –∫–æ—Ä–ø. 90.",
                imgUrl: "https://loremflickr.com/200/300?random=5",
                lat: 59.945202,
                lng: 30.344276,
            },
            
        ];

        const infoWindows = [];
        const compmanyName = '–ö–æ–∫—Å–±–µ—Ä—Ä–∏';
        const currentCityId = 1; // –ú–æ—Å–∫–≤–∞
        const currentCity = cities.find(city => city.id === currentCityId);

        let map;

        function initMap() {

            map = new google.maps.Map(document.getElementById("map"), {
                center: {lat: currentCity.lat, lng: currentCity.lng},
                zoom: 11,
                disableDefaultUI: true
            });

            points.forEach((point) => {

                const marker = new google.maps.Marker({ position: {lat: point.lat, lng: point.lng}, map: map });

                const content = `<div>
                    <h3>${compmanyName}</h3>
                    <div>
                        <img src="${point.imgUrl}"/>
                        <address>${point.address}</address>
                    </div>
                </div>`;

                const infoWindow = new google.maps.InfoWindow({ content: content });
                infoWindows.push(infoWindow); 

                marker.addListener('click', () => {
                    infoWindows.forEach(infoWindow => infoWindow.close());
                    infoWindow.open(map, marker);
                });
            });

        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –≥–æ—Ä–æ–¥–∞–º–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞
        const options = cities.map(city => `<option value="${city.id}" ${(currentCityId == city.id) && 'selected'}>${city.name}</option>`);
        document.querySelector("#city").insertAdjacentHTML("beforeend", options);

        // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞
        document.querySelector("#city").addEventListener("change", (event) => {

            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ –ø–æ id
            const selectedCityId = event.target.value;
            const selectedCity = cities.find(city => city.id == selectedCityId);

            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ –≤—ã–±—Ä–∞–Ω–æ–º—É –≥–æ—Ä–æ–¥—É
            map.setOptions({
                center: {lat: selectedCity.lat, lng: selectedCity.lng},
                zoom: selectedCity.zoom
            });
        })

        // –†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≥–æ—Ä–æ–¥—É! üéâ
        // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–µ—Ç–æ–¥–∞–º –æ–±—ä–µ–∫—Ç–∞ Map: https://developers.google.com/maps/documentation/javascript/reference/map
        // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: https://developers.google.com/maps/documentation/javascript/examples/control-replacement
        // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ –º–µ—Ç–æ–¥ find: https://learn.javascript.ru/array-methods#find-i-findindex

        // TODO:
        // 1. –†–∞–∑–±–∏—Ç—å –∫–æ–¥ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏
        // 2. –ó–∞—é–∑–∞—Ç—å –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞
        
    </script>
</body>

</html>